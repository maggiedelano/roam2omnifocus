<%JAVASCRIPT:function queryAND(t,n){return t.filter(t=>n.includes(t))}function queryNOT(t,n){return window.roamAlphaAPI.q("[:find ?blockIDs\n\t\t\t\t:in $ ?pageName [?blockIDs ...]\n\t\t\t\t:where [?tagID :node/title ?pageName] \n\t\t\t\t\t(not (?blockIDs :block/refs ?tagID)) ]",t,n).map((t,n)=>t[0])}function getAllParentsAndChildrenForTag(t){return pageBlocks=findAllBlocksOnPage(t),referenceBlocks=findReferenceParentAndChildren(t),allBlocks=pageBlocks.concat(referenceBlocks),allBlocks}function getBlockStringsFromIDs(t){return blockStrings=window.roamAlphaAPI.q("[:find ?blockStrings\n\t\t\t\t  :in $  [?blockIDs ...]\n\t\t\t\t  :where [?blockIDs :block/string ?blockStrings]]",t),blockStrings.map((t,n)=>cleanUpBlockString(t[0])).join("\n")}function findAllBlocksOnPage(t){let n=window.roamAlphaAPI.q("[:find ?blockIDs\n  \t\t\t\t\t\t\t\t\t\t :in $ ?pagetitle % \n  \t\t\t\t\t\t\t\t\t\t :where [?page :node/title ?pagetitle] \n      \t\t\t\t\t\t\t\t\t\t\t(ancestor ?blockIDs ?page)\n  \t\t\t\t\t\t\t\t\t\t\t\t]",t,"[ \n  [(ancestor ?child ?parent)\n   [?parent :block/children ?child]]\n  [(ancestor ?child ?ancestor)\n   [?parent :block/children ?child]\n   (ancestor ?parent ?ancestor)]\n\t]");return blocks=n.map((t,n)=>t[0]),blocks}function findReferenceParentAndChildren(t){let n=window.roamAlphaAPI.q("[:find ?blockIDs\n\t\t\t  :in $ ?pageName\n\t\t\t  :where [?pageID :node/title ?pageName]\n\t\t\t\t\t [?blockIDs :block/refs ?pageID]\n\t\t\t\t\t [?blockIDs :block/string ?blockStrings]]",t);parents=n.map((t,n)=>t[0]);let e=window.roamAlphaAPI.q("[:find ?childIDs ?childStrings\n \t\t\t  \t\t\t :in $ % [?blockIDs ...] \n\t\t\t  \t\t\t :where [?childIDs :block/string ?childStrings]\n\t\t\t\t\t \t (ancestor ?childIDs ?blockIDs)]","[ \n  [(ancestor ?child ?parent)\n   [?parent :block/children ?child]]\n  [(ancestor ?child ?ancestor)\n   [?parent :block/children ?child]\n   (ancestor ?parent ?ancestor)]\n\t]",parents);return children=e.map((t,n)=>t[0]),parents.concat(children)}function writeResultsToClipboard(t){navigator.clipboard.writeText(t)}function cleanUpBlockString(t){return t=t.replace("{{[[TODO]]}} ","")}tag1Blocks=getAllParentsAndChildrenForTag("next action"),tag2Blocks=getAllParentsAndChildrenForTag("Project/Current Source Testing"),tag3Blocks=getAllParentsAndChildrenForTag("TODO"),writeResultsToClipboard(getBlockStringsFromIDs(queryNOT("query",queryAND(tag1Blocks,queryAND(tag2Blocks,tag3Blocks))))),window.open("omnifocus:///inbox"); return ''%> 